<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Applicant</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="householdedit.css">
    <link rel="stylesheet" href="notes.css">
    <script src="userInfo.js"></script>

    <style>

#editSSNButton {
        position: relative; /* Ensures the button stays in the same flow */
        margin-top: 10px; /* Adds spacing below the field */
    }

select:disabled {
    cursor: default; /* Ensures the cursor remains the default arrow */
}
details > summary {
    cursor: pointer; /* Change cursor to hand */
}

.button-container button {
    border: 1px solid #000000; /* Add a blue border */
    border-radius: 5px; /* Optional: Add rounded corners */
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; /* Smooth transition for hover effects */
}

.button-container button:hover {
    background-color: #0056b3; /* Darker blue background on hover */
    color: white; /* Ensure text is visible */
    border-color: #003f7f; /* Darker border color on hover */
}

.error {
    border: 2px solid red;
}

.household-member-info p {
    text-align: left; /* Ensure text is left-aligned */
    word-wrap: break-word; /* Allow long words to break and wrap */
    white-space: normal; /* Ensure normal wrapping behavior */
}
body {
    max-width: 1200px; /* Adjust the max-width as needed */
    margin: 0 auto;
    padding: 20px;
    margin-top: 60px; /* Adjust this value to match the height of the navigation container */

}
        
    </style>
    <style>
        .button-container {
                display: flex;
                gap: 10px; /* Adds spacing between buttons */
                flex-wrap: wrap; /* Ensures buttons wrap to the next line if needed */
            }
        
            .button-container button {
                flex: 1; /* Ensures buttons are evenly spaced */
                padding: 10px 15px;
            }

            /* Modal content styling */
.modal-content {
    background-color: #ffffff;
    border-radius: 10px;
    width: 100%;
    max-width: 500px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    position: relative;
    text-align: center;
}

.narrow-body {
        margin-left: 385px; /* Space for the left sidebar */
        margin-right: 10px; /* Optional: Space on the right */
        max-width: calc(100% - 395px); /* Ensure the body doesn't exceed the available space */
        margin: 0 auto; /* Center the content horizontally */
        margin-top: 60px; /* Adjust this value to match the height of the navigation container */
    }
        
            </style>
</head>
<body class="narrow-body">

    <h1>Applicant</h1>

    <style>
        #household-size {
            text-align: center; /* Center the text */
            text-align-last: center; /* Center the selected option in modern browsers */
        }
    </style>

<div class="left-sidebar-container" id="leftSidebarContainer" style="display: none;">
    <div id="snap-household-container" class="left-sidebar"></div>
    <div id="liheap-household-container" class="left-sidebar"></div>
    <div id="household-members-container" class="left-sidebar"></div>
</div>

<div id="notes-container">
    <textarea id="note-input" placeholder="Add Note..."></textarea>
    <button id="save-note">Save Note</button>
    <div id="notes-list">
        </div>
        </div>

    <div id="householdMemberContainer" class="household-member-container"></div>

    <div class="form-field">
        <label for="county">County:</label>
        <select id="county" name="county">
            <option value="" disabled selected>Select County</option>
            <option value="Adams">Adams</option>
            <option value="Allegheny">Allegheny</option>
            <option value="Armstrong">Armstrong</option>
            <option value="Beaver">Beaver</option>
            <option value="Bedford">Bedford</option>
            <option value="Berks">Berks</option>
            <option value="Blair">Blair</option>
            <option value="Bradford">Bradford</option>
            <option value="Bucks">Bucks</option>
            <option value="Butler">Butler</option>
            <option value="Cambria">Cambria</option>
            <option value="Cameron">Cameron</option>
            <option value="Carbon">Carbon</option>
            <option value="Centre">Centre</option>
            <option value="Chester">Chester</option>
            <option value="Clarion">Clarion</option>
            <option value="Clearfield">Clearfield</option>
            <option value="Clinton">Clinton</option>
            <option value="Columbia">Columbia</option>
            <option value="Crawford">Crawford</option>
            <option value="Cumberland">Cumberland</option>
            <option value="Dauphin">Dauphin</option>
            <option value="Delaware">Delaware</option>
            <option value="Elk">Elk</option>
            <option value="Erie">Erie</option>
            <option value="Fayette">Fayette</option>
            <option value="Forest">Forest</option>
            <option value="Franklin">Franklin</option>
            <option value="Fulton">Fulton</option>
            <option value="Greene">Greene</option>
            <option value="Huntingdon">Huntingdon</option>
            <option value="Indiana">Indiana</option>
            <option value="Jefferson">Jefferson</option>
            <option value="Juniata">Juniata</option>
            <option value="Lackawanna">Lackawanna</option>
            <option value="Lancaster">Lancaster</option>
            <option value="Lawrence">Lawrence</option>
            <option value="Lebanon">Lebanon</option>
            <option value="Lehigh">Lehigh</option>
            <option value="Luzerne">Luzerne</option>
            <option value="Lycoming">Lycoming</option>
            <option value="McKean">McKean</option>
            <option value="Monroe">Monroe</option>
            <option value="Montgomery">Montgomery</option>
            <option value="Montour">Montour</option>
            <option value="Northampton">Northampton</option>
            <option value="Northumberland">Northumberland</option>
            <option value="Perry">Perry</option>
            <option value="Philadelphia">Philadelphia</option>
            <option value="Pike">Pike</option>
            <option value="Potter">Potter</option>
            <option value="Schuylkill">Schuylkill</option>
            <option value="Snyder">Snyder</option>
            <option value="Somerset">Somerset</option>
            <option value="Sullivan">Sullivan</option>
            <option value="Susquehanna">Susquehanna</option>
            <option value="Tioga">Tioga</option>
            <option value="Union">Union</option>
            <option value="Venango">Venango</option>
            <option value="Warren">Warren</option>
            <option value="Washington">Washington</option>
            <option value="Wayne">Wayne</option>
            <option value="Westmoreland">Westmoreland</option>
            <option value="Wyoming">Wyoming</option>
            <option value="York">York</option>
        </select>
    </div>

    <div class="form-field">
        <label for="schoolDistrict">School District:</label>
        <select id="schoolDistrict" name="schoolDistrict" disabled>
            <option value="" disabled selected>Select School District</option>
        </select>
    </div>



    <div class="button-container">
        <button id="add-household-member" style="display: none;">Add Household Member</button>
        <button id="save-exit" onclick="redirectToHouseholdView()">Save and Release Profile</button>
        <button id="save-continue" onclick="goToRelationshipsEdit()">Save and Continue</button> <br>
    </div>

<!-- Add this to your HTML -->
<div id="loading-indicator" style="display: none;">Loading...</div>

<div id="householdMemberModal" class="modal">
    <div class="modal-content">
        <form id="householdMemberForm">

            <h2 id="modal-header">Add Household Member</h2>

            <input type="hidden" id="householdMemberId">
            <label for="firstName">First Name:</label>
            <input type="text" id="firstName" name="firstName"><br><br>
            <label for="middleInitial">Middle Initial:</label>
            <input type="text" id="middleInitial" name="middleInitial"><br><br>
            <label for="lastName">Last Name:</label>
            <input type="text" id="lastName" name="lastName"><br><br>
            <div class="selection-box">
                <label for="dob">Date of Birth:</label>
                <input type="date" id="dob" name="dob" class="selection-box-input"><br><br>
            </div>
            <div class="selection-box">
                <label for="legalSex">Legal Sex:</label>
                <select id="legalSex" name="legalSex" class="selection-box-input">
                    <option value="" disabled selected>Select Legal Sex</option>
                    <option value="MALE">MALE</option>
                    <option value="FEMALE">FEMALE</option>
                    </select><br><br>
            </div>
            <label for="socialSecurityNumber">Social Security Number:</label>
<input 
    type="text" 
    id="socialSecurityNumber" 
    name="socialSecurityNumber" 
    placeholder="xxx-xx-xxxx" 
    maxlength="11" 
    oninput="formatSSN(this)" 
    >
<button type="button" id="nextSSNButton" onclick="showConfirmSSN()" style="display: none;">Next</button><br><br>

<div id="confirmSSNContainer" style="display: none;">
    <label for="confirmSocialSecurityNumber">Confirm Social Security Number:</label>
    <input 
        type="text" 
        id="confirmSocialSecurityNumber" 
        name="confirmSocialSecurityNumber" 
        placeholder="xxx-xx-xxxx" 
        maxlength="11" 
        oninput="formatSSN(this)" 
    >
    <button type="button" id="confirmSSNButton" onclick="confirmSSN()" style="display: none;">Confirm</button>
    <button type="button" id="editSSNButton" onclick="editSSN()" style="display: none;">Edit SSN</button>
</div>

<div class="selection-box">
    <label for="maritalStatus">Current Marital Status:</label>
    <select id="maritalStatus" name="maritalStatus" class="selection-box-input" disabled>
        <option value="" disabled selected>Select Marital Status</option>
        <option value="Single">Single</option>
        <option value="Married (Living Together)">Married (Living Together)</option>
        <option value="Married (Living Separately)">Married (Living Separately)</option>
        <option value="Divorced">Divorced</option>
        <option value="Widowed">Widowed</option>
    </select><br><br>
</div>
<div class="selection-box">
    <label for="previousMaritalStatus">Previous Year Marital Status:</label>
    <select id="previousMaritalStatus" name="previousMaritalStatus" class="selection-box-input" disabled>
        <option value="" disabled selected>Select Previous Year Marital Status</option>
        <option value="Single">Single</option>
        <option value="Married (Living Together)">Married (Living Together)</option>
        <option value="Married (Living Separately)">Married (Living Separately)</option>
        <option value="Divorced">Divorced</option>
        <option value="Widowed">Widowed</option>
    </select><br><br>
</div>
<div id="disabilityQuestion" class="selection-box">
    <label>Is this person receiving disability benefits?</label>
    <div id="modal-disability-yes" data-value="yes" style="pointer-events: none; opacity: 0.5;">Yes</div>
    <div id="modal-disability-no" data-value="no" style="pointer-events: none; opacity: 0.5;">No</div>
</div>
<div id="medicareQuestion" class="selection-box">
    <label>Is this person enrolled in Medicare (or will they be within the next three months)?</label>
    <div id="modal-medicare-yes" data-value="yes" style="pointer-events: none; opacity: 0.5;">Yes</div>
    <div id="modal-medicare-no" data-value="no" style="pointer-events: none; opacity: 0.5;">No</div>
</div>
<div id="medicaidQuestion" class="selection-box">
    <label>Is this person enrolled in Medicaid?</label>
    <div id="modal-medicaid-yes" data-value="yes" style="pointer-events: none; opacity: 0.5;">Yes</div>
    <div id="modal-medicaid-no" data-value="no" style="pointer-events: none; opacity: 0.5;">No</div>
</div>
<div id="citizenQuestion" class="selection-box">
    <label>Is this person a U.S. citizen?</label>
    <div id="modal-citizen-yes" data-value="yes" style="pointer-events: none; opacity: 0.5;">Yes</div>
    <div id="modal-citizen-no" data-value="no" style="pointer-events: none; opacity: 0.5;">No</div>
</div>
<div id="nonCitizenStatusContainer" style="display: none; margin-top: 10px;">
    <label for="nonCitizenStatus">Select Non-Citizenship Status:</label>
    <select id="nonCitizenStatus" disabled>
        <option value="" disabled selected>Select status</option>
        <option value="Lawful Permanent Resident (5+ Years)">Lawful Permanent Resident (5+ Years)</option>
        <option value="Refugee">Refugee</option>
        <option value="Asylee">Asylee</option>
        <option value="Person Whose Deportation is Withheld">Person Whose Deportation is Withheld</option>
        <option value="Conditional Entrant (5+ Years)">Conditional Entrant (5+ Years)</option>
        <option value="Victim of Severe Trafficking">Victim of Severe Trafficking</option>
        <option value="Cuban or Haitian Entrant">Cuban or Haitian Entrant</option>
        <option value="Iraqi or Afghan Special Immigrant">Iraqi or Afghan Special Immigrant</option>
        <option value="Child Under 18 in Qualified Non-Citizen Category">Child Under 18 in Qualified Non-Citizen Category</option>
        <option value="Hmong or Highland Laotian Tribal Members">Hmong or Highland Laotian Tribal Members</option>
        <option value="Citizen of Micronesia, Marshall Islands, or Palau">Citizen of Micronesia, Marshall Islands, or Palau</option>
        <option value="Amerasian">Amerasian</option>
        <option value="Person Paroled in the U.S. (1+ Years)">Person Paroled in the U.S. (1+ Years)</option>
        <option value="Non-Citizen Who is Blind or Disabled and Receiving Disability Benefits">Non-Citizen Who is Blind or Disabled and Receiving Disability Benefits</option>
        <option value="Non-Citizen Who Was 65+ and Lawfully Residing in the U.S. on August 22, 1996">Non-Citizen Who Was 65+ and Lawfully Residing in the U.S. on August 22, 1996</option>
        <option value="Ineligible Non-Citizen">Ineligible Non-Citizen</option>
    </select>
</div>
<div id="studentQuestion" class="selection-box">
    <label>Is this person a student?</label>
    <div id="modal-student-yes" data-value="yes" style="pointer-events: none; opacity: 0.5;">Yes</div>
    <div id="modal-student-no" data-value="no" style="pointer-events: none; opacity: 0.5;">No</div>
</div>
<div id="studentStatusContainer" style="display: none; margin-top: 10px;">
    <label for="studentStatus">Select Student Status:</label>
    <select id="studentStatus" disabled>
        <option value="" disabled selected>Select status</option>
        <option value="Enrolled Less than Half-Time">Enrolled Less than Half-Time</option>
        <option value="Under Age 18">Under Age 18</option>
        <option value="High School Student">High School Student</option>
        <option value="Age 50 or Older">Age 50 or Older</option>
        <option value="Physically or Mentally Unfit for Employment">Physically or Mentally Unfit for Employment</option>
        <option value="Employed at Least 20 Hours Per Week">Employed at Least 20 Hours Per Week</option>
        <option value="Participating in a Work Study Program">Participating in a Work Study</option>
        <option value="Participating in a Job Training Program">Participating in a Job Training Program</option>
        <option value="Assigned to or Placed in College through a SNAP Employment or Training Program">Assigned to or Placed in College through a SNAP Employment or Training Program</option>
        <option value="Responsible for the Care of a Child Under 6">Responsible for the Care of a Child Under 6</option>
        <option value="Responsible for the Care of a Child Aged 6-12 and No Adequate Child Care Available">Responsible for the Care of a Child Aged 6-12 and No Adequate Child Care Available</option>
        <option value="Single Parent Enrolled Full-Time and Responsible for a Child Under 12">Single Parent Enrolled Full-Time and Responsible for a Child Under 12</option>
        <option value="TANF Recipient">TANF Recipient</option>
        <option value="Ineligible Student">Ineligible Student</option>
    </select></div>
<div id="mealsQuestion" class="selection-box">
    <label>Is this person included in the SNAP household?</label>
    <div id="modal-meals-yes" data-value="yes" style="pointer-events: none; opacity: 0.5;">Yes</div>
    <div id="modal-meals-no" data-value="no" style="pointer-events: none; opacity: 0.5;">No</div>
</div>
            <button type="button" id="add-member" class="submit-button">Add Member</button>

        </form>

    <script>
// Utility function to get query parameters
function getQueryParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
}

        function goToRelationshipsEdit() {
    const clientId = getQueryParameter('id');
    if (clientId) {
        window.location.href = `relationshipsedit.html?id=${clientId}`;
    } else {
        console.error('Client ID not found in query parameters.');
    }
}

async function loadClientData() {
    const clientId = getQueryParam('id'); // Get the client ID from the URL

    try {
        const response = await fetch(`/get-client/${clientId}`); // Fetch client data
        if (!response.ok) {
            throw new Error(`Failed to fetch client: ${response.statusText}`);
        }

        const client = await response.json(); // Parse the client data
        if (client && client.county) {
            console.log('Client data loaded:', client);
            console.log('Client county:', client.county);

            // Autofill the county dropdown
            const countyDropdown = document.getElementById('county');
            const countyOptions = Array.from(countyDropdown.options);

            console.log('Dropdown options:', countyOptions.map(option => option.value)); // Log all dropdown options

            // Find the matching option (case-insensitive)
            const matchingCountyOption = countyOptions.find(
                (option) => option.value.toLowerCase() === client.county.toLowerCase()
            );

            if (matchingCountyOption) {
                countyDropdown.value = matchingCountyOption.value; // Set the dropdown value
                console.log(`County dropdown set to: ${matchingCountyOption.value}`);

                // Populate the school district dropdown based on the selected county
                populateSchoolDistricts(matchingCountyOption.value);

                // Autofill the school district dropdown if it exists in the client data
                if (client.schoolDistrict) {
                    const schoolDistrictDropdown = document.getElementById('schoolDistrict');
                    const districtOptions = Array.from(schoolDistrictDropdown.options);

                    const matchingDistrictOption = districtOptions.find(
                        (option) => option.value.toLowerCase() === client.schoolDistrict.toLowerCase()
                    );

                    if (matchingDistrictOption) {
                        schoolDistrictDropdown.value = matchingDistrictOption.value;
                        console.log(`School district dropdown set to: ${matchingDistrictOption.value}`);
                    } else {
                        console.warn(`No matching school district found for: ${client.schoolDistrict}`);
                    }
                }
            } else {
                console.warn(`No matching county found for: ${client.county}`);
            }
        } else {
            console.error('Client data is missing or county is not defined.');
        }
    } catch (error) {
        console.error('Error loading client data:', error);
    }
}

// Populate the school district dropdown based on the selected county
function populateSchoolDistricts(county) {
    const schoolDistrictDropdown = document.getElementById('schoolDistrict');

    // Clear existing options
    schoolDistrictDropdown.innerHTML = '<option value="" disabled selected>Select School District</option>';

    // Get the school districts for the selected county
    const districts = schoolDistricts[county] || [];

    // Enable the dropdown if districts are available
    if (districts.length > 0) {
        schoolDistrictDropdown.disabled = false;

        // Add the districts as options
        districts.forEach(district => {
            const option = document.createElement('option');
            option.value = district;
            option.textContent = district;
            schoolDistrictDropdown.appendChild(option);
        });
    } else {
        // Disable the dropdown if no districts are available
        schoolDistrictDropdown.disabled = true;
    }
}

// Ensure the script runs after the DOM is fully loaded
document.addEventListener('DOMContentLoaded', () => {
    loadClientData();
});

const schoolDistricts = {
    "Adams": ["Bermudian Springs School District", "Conewago Valley School District", "Fairfield Area School District", "Gettysburg Area School District", "Littlestown Area School District", "Upper Adams School District"],
    "Allegheny": ["Allegheny Valley School District", "Avonworth School District", "Baldwin-Whitehall School District", "Bethel Park School District", "Brentwood Borough School District"],
    "Armstrong": ["Apollo-Ridge School District", "Armstrong School District", "Bradys Bend Area School District", "Kittanning Area School District", "Leechburg Area School District"],
    "Beaver": ["Aliquippa School District", "Ambridge Area School District", "Beaver Area School District", "Blackhawk School District", "Center Area School District"],
    "Bedford": ["Bedford Area School District", "Everett Area School District", "Fulton County School District", "Northern Bedford County School District", "Southern Bedford County School District"],
    "Berks": ["Antietam School District", "Boyertown Area School District", "Brandywine Heights Area School District", "Daniel Boone Area School District", "East Penn School District"],
    "Blair": ["Altoona Area School District", "Bellwood-Antis School District", "Claysburg-Kimmel School District", "Hollidaysburg Area School District", "Juniata Valley School District"],
    "Bradford": ["Athens Area School District", "Bradford Area School District", "Canton Area School District", "Sayre Area School District", "Troy Area School District"],
    "Bucks": ["Bensalem Township School District", "Bristol Borough School District", "Bristol Township School District", "Buckingham Township School District", "Central Bucks School District"],
    "Butler": ["Butler Area School District", "Cabot School District", "Connoquenessing Area School District", "Hampton Township School District", "Mars Area School District"],
    "Cambria": ["Cambria Heights School District", "Conemaugh Valley School District", "Ferndale Area School District", "Greater Johnstown School District", "Northern Cambria School District"],
    "Cameron": ["Cameron County School District"],
    "Carbon": ["Lehighton Area School District", "Palmerton Area School District", "Souderton Area School District", "Weatherly Area School District"],
    "Centre": ["Bellefonte Area School District", "State College Area School District", "Philipsburg-Osceola Area School District"],
    "Chester": ["Avon Grove School District", "Coatesville Area School District", "Downingtown Area School District", "Great Valley School District", "Kennett Consolidated School District"],
    "Clarion": ["Clarion Area School District", "Eldred School District", "Forest Area School District", "Keystone School District", "Redbank Valley School District"],
    "Clearfield": ["Curwensville Area School District", "DuBois Area School District", "Graffius School District", "Moshannon Valley School District", "West Branch Area School District"],
    "Clinton": ["Clinton County School District", "Muncy School District"],
    "Columbia": ["Berwick Area School District", "Bloomsburg Area School District", "Central Columbia School District", "Danville Area School District", "Millville Area School District"],
    "Crawford": ["Cranberry Area School District", "Conneaut Area School District", "Linesville Area School District", "Meadville Area School District", "Northwestern School District"],
    "Cumberland": ["Cumberland Valley School District", "East Pennsboro Area School District", "Shippensburg Area School District", "South Middleton School District", "West Shore School District"],
    "Dauphin": ["Central Dauphin School District", "Dauphin County Technical School", "Halifax Area School District", "Harrisburg School District", "Lower Dauphin School District"],
    "Delaware": ["Chichester School District", "Concord School District", "Delaware County Technical School", "Garnet Valley School District", "Haverford Township School District"],
    "Elk": ["Elk County School District"],
    "Erie": ["Corry Area School District", "Erie City School District", "Fairview School District", "Fort LeBoeuf School District", "Girard School District"],
    "Fayette": ["Albert Gallatin Area School District", "Brownsville Area School District", "Connellsville Area School District", "Fayette County Area School District", "Uniontown Area School District"],
    "Forest": ["Forest Area School District"],
    "Franklin": ["Chambersburg Area School District", "Fannett-Metal School District", "Greencastle-Antrim School District", "Shippensburg Area School District"],
    "Fulton": ["Fulton County School District"],
    "Greene": ["Greene County School District", "Jefferson-Morgan School District"],
    "Huntingdon": ["Huntingdon Area School District", "Mount Union Area School District", "Southern Huntingdon County School District"],
    "Indiana": ["Indiana Area School District", "Penns Manor Area School District", "Purchase Line School District"],
    "Jefferson": ["Brookville Area School District", "DuBois Area School District", "Punxsutawney Area School District"],
    "Juniata": ["Juniata County School District"],
    "Lackawanna": ["Carbondale Area School District", "Lakeland School District", "Mid Valley School District", "North Pocono School District", "Scranton School District"],
    "Lancaster": ["Conestoga Valley School District", "Cocalico School District", "Columbia Borough School District", "Donegal School District", "Ephrata Area School District"],
    "Lawrence": ["Ellwood City Area School District", "Lawrence County School District", "Neshannock Township School District"],
    "Lebanon": ["Annville-Cleona School District", "Cornwall-Lebanon School District", "Eastern Lebanon County School District", "Lebanon School District", "Northern Lebanon School District"],
    "Lehigh": ["Allentown School District", "Catasauqua Area School District", "East Penn School District", "Northern Lehigh School District", "Parkland School District"],
    "Luzerne": ["Dallas School District", "Hazleton Area School District", "Kingston Area School District", "Lake-Lehman School District", "Nanticoke Area School District"],
    "Lycoming": ["Canton Area School District", "Muncy School District", "South Williamsport Area School District", "Wellsboro Area School District"],
    "McKean": ["Bradford Area School District", "Cameron County School District", "Port Allegany School District"],
    "Monroe": ["East Stroudsburg Area School District", "Pleasant Valley School District", "Stroudsburg Area School District"],
    "Montgomery": ["Abington School District", "Cheltenham Township School District", "Hatboro-Horsham School District", "Lower Merion School District", "Methacton School District"],
    "Montour": ["Montour School District"],
    "Northampton": ["Bethlehem Area School District", "Easton Area School District", "Nazareth Area School District", "Northampton Area School District", "Pen Argyl Area School District"],
    "Northumberland": ["Danville Area School District", "Line Mountain School District", "Milton Area School District", "Shamokin Area School District", "Warrior Run School District"],
    "Perry": ["Duncannon Borough School District", "Newport School District", "Susquenita School District"],
    "Philadelphia": ["Philadelphia City School District"],
    "Pike": ["Delaware Valley School District", "Wallenpaupack Area School District"],
    "Potter": ["Coudersport Area School District", "Oswayo Valley School District"],
    "Schuylkill": ["Blue Mountain School District", "Mahanoy Area School District", "Minersville Area School District", "North Schuylkill School District", "Pottsville Area School District"],
    "Snyder": ["Middleburg Area School District", "Selinsgrove Area School District", "Shamokin Dam Area School District"],
    "Somerset": ["Conemaugh Township Area School District", "North Star School District", "Rockwood Area School District", "Somerset Area School District"],
    "Sullivan": ["Sullivan County School District"],
    "Susquehanna": ["Forest City Regional School District", "Montrose Area School District"],
    "Tioga": ["Elkland Area School District", "Wellsboro Area School District"],
    "Union": ["Lewisburg Area School District", "Mifflinburg Area School District"],
    "Venango": ["Cranberry Area School District", "Franklin Area School District", "Oil City Area School District"],
    "Warren": ["Warren County School District"],
    "Washington": ["Bentleyville School District", "California Area School District", "Charleroi Area School District", "Fort Cherry School District", "McGuffey School District"],
    "Wayne": ["Honesdale School District", "Wallenpaupack Area School District"],
    "Westmoreland": ["Derry Area School District", "Greensburg-Salem School District", "Hempfield Area School District", "Jeannette City School District", "Latrobe Area School District"],
    "Wyoming": ["Tunkhannock Area School District"],
    "York": ["Central York School District", "Dallastown Area School District", "Eastern York School District", "Hanover Public School District", "Red Lion Area School District"]
};

// Ensure the script runs after the DOM is fully loaded
document.addEventListener('DOMContentLoaded', () => {
    loadClientData();

    // Add a listener for the county dropdown
    const countyDropdown = document.getElementById('county');
    countyDropdown.addEventListener('change', (event) => {
        const selectedCounty = event.target.value;

        // Reset the school district dropdown to its default state
        const schoolDistrictDropdown = document.getElementById('schoolDistrict');
        schoolDistrictDropdown.innerHTML = '<option value="" disabled selected>Select School District</option>';
        schoolDistrictDropdown.disabled = true;

        // Repopulate the district list based on the selected county
        populateSchoolDistricts(selectedCounty);

        // Update the client array with the new county
        updateClientData('county', selectedCounty);

        // Clear the district value in the client array
        updateClientData('schoolDistrict', '');
    });

    // Add a listener for the school district dropdown
    const schoolDistrictDropdown = document.getElementById('schoolDistrict');
    schoolDistrictDropdown.addEventListener('change', (event) => {
        const selectedDistrict = event.target.value;
        updateClientData('schoolDistrict', selectedDistrict); // Update the client array with the new district
    });
});

// Function to update the client data
function updateClientData(key, value) {
    const clientId = getQueryParam('id'); // Get the client ID from the URL

    if (!clientId) {
        console.error('Client ID not found in query parameters.');
        return;
    }

    const requestBody = {
        clientId,
        clientData: { [key]: value }, // Dynamically set the key and value
    };

    // Update the client data via REST API
    fetch(`/update-client`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(requestBody),
    })
        .then((response) => {
            if (response.ok) {
                console.log(`Client ${key} updated to: ${value}`);
            } else {
                return response.json().then((error) => {
                    console.error('Error details:', error);
                    throw new Error(`Failed to update client data: ${error.message}`);
                });
            }
        })
        .catch((error) => {
            console.error('Error updating client data:', error);
        });
}

function redirectToHouseholdView() {
    const clientId = getQueryParam('id');
    if (clientId) {
        const userConfirmed = confirm("Are you sure you want to save and release the profile?");
        if (userConfirmed) {
            const requestBody = {
                clientId,
                clientData: { screeningInProgress: false },
            };

            console.log('Request body:', requestBody); // Log the request body for debugging

            // Update screeningInProgress to false in the database via REST API
            fetch(`/update-client`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestBody),
            })
                .then((response) => {
                    if (response.ok) {
                        console.log('screeningInProgress set to false for client:', clientId);
                    } else {
                        return response.json().then((error) => {
                            console.error('Error details:', error);

                            // Check if the error message indicates no changes were made
                            if (error.message === 'No changes were made to the client data.') {
                                console.log('No changes were made, but proceeding with redirect.');
                            } else {
                                throw new Error(`Failed to update client data: ${error.message}`);
                            }
                        });
                    }
                })
                .catch((error) => {
                    console.error('Error updating client data:', error);
                })
                .finally(() => {
                    // Redirect to the household view page regardless of success or failure
                    window.location.href = `householdview.html?id=${clientId}`;
                });
        } else {
            console.log("User canceled the action.");
        }
    } else {
        console.error('Client ID not found in query parameters.');
    }
}

async function toggleSidebarVisibility() {
    const clientId = getQueryParam('id');
    try {
        // Fetch client data via REST API
        const response = await fetch(`/get-client/${clientId}`);
        if (!response.ok) {
            throw new Error(`Failed to fetch client data: ${response.statusText}`);
        }
        const client = await response.json();
        console.log('Client data:', client); // Debugging
        console.log('screeningInProgress:', client?.screeningInProgress); // Debugging

        if (client && client.screeningInProgress) {
            document.getElementById('leftSidebarContainer').style.display = 'block';
            console.log('Sidebar is now visible'); // Debugging
        } else {
            document.getElementById('leftSidebarContainer').style.display = 'none';
            console.log('Sidebar is now hidden'); // Debugging
        }
    } catch (error) {
        console.error('Error toggling sidebar visibility:', error);
    }
}

function showConfirmSSN() {
    const ssnLabel = document.querySelector('label[for="socialSecurityNumber"]');
    const ssnInput = document.getElementById('socialSecurityNumber');
    const nextButton = document.getElementById('nextSSNButton');
    const confirmSSNContainer = document.getElementById('confirmSSNContainer');

    // Check if the SSN field is filled
    if (ssnInput.value.length === 11) {
        // Hide the SSN label, input, and button
        ssnLabel.style.display = 'none';
        ssnInput.style.display = 'none';
        nextButton.style.display = 'none';

        // Show the Confirm SSN input
        confirmSSNContainer.style.display = 'block';
    } else {
        alert('Please enter a valid Social Security Number before proceeding.');
    }
}

function resetSSNFields() {
    const ssnLabel = document.querySelector('label[for="socialSecurityNumber"]');
    const ssnInput = document.getElementById('socialSecurityNumber');
    const nextButton = document.getElementById('nextSSNButton');
    const confirmSSNContainer = document.getElementById('confirmSSNContainer');
    const confirmSSNInput = document.getElementById('confirmSocialSecurityNumber');

    // Reset visibility
    ssnLabel.style.display = 'block';
    ssnInput.style.display = 'block';
    nextButton.style.display = 'inline-block';
    confirmSSNContainer.style.display = 'none';

    // Clear input values
    ssnInput.value = '';
    confirmSSNInput.value = '';
}

function formatSSN(input) {
    const nextButton = document.getElementById('nextSSNButton');

    // Remove all non-digit characters
    let value = input.value.replace(/\D/g, '');

    // Format the value as ###-##-####
    if (value.length > 3 && value.length <= 5) {
        value = `${value.slice(0, 3)}-${value.slice(3)}`;
    } else if (value.length > 5) {
        value = `${value.slice(0, 3)}-${value.slice(3, 5)}-${value.slice(5, 9)}`;
    }

    // Set the formatted value back to the input
    input.value = value;

    // Only show the "Next" button for the initial SSN field
    if (input.id === 'socialSecurityNumber') {
        if (value.length === 11) {
            nextButton.style.display = 'inline-block';
        } else {
            nextButton.style.display = 'none';
        }
    }
}

function validateConfirmSSN() {
    const ssnInput = document.getElementById('socialSecurityNumber');
    const confirmSSNInput = document.getElementById('confirmSocialSecurityNumber');
    const confirmButton = document.getElementById('confirmSSNButton');
    const editSSNButton = document.getElementById('editSSNButton');

    // Check if the confirm SSN field has 11 characters
    if (confirmSSNInput.value.length === 11) {
        if (confirmSSNInput.value !== ssnInput.value) {
            alert('The Social Security Numbers entered do not match. Please try again.');
            resetSSNFields(); // Reset both fields
        } else {
            // Enable the "Confirm" button
            confirmButton.style.display = 'inline-block';
        }
    } else {
        // Hide the "Confirm" button if the input is incomplete
        confirmButton.style.display = 'none';
    }
}

function confirmSSN() {
    const ssnInput = document.getElementById('socialSecurityNumber');
    const confirmSSNInput = document.getElementById('confirmSocialSecurityNumber');
    const confirmButton = document.getElementById('confirmSSNButton');
    const editSSNButton = document.getElementById('editSSNButton');

    // Make the SSN fields read-only
    ssnInput.readOnly = true;
    confirmSSNInput.readOnly = true;

    // Hide the "Confirm" button and show the "Edit SSN" button
    confirmButton.style.display = 'none';
    editSSNButton.style.display = 'inline-block';
}

function editSSN() {
    const ssnInput = document.getElementById('socialSecurityNumber');
    const confirmSSNInput = document.getElementById('confirmSocialSecurityNumber');
    const confirmButton = document.getElementById('confirmSSNButton');
    const editSSNButton = document.getElementById('editSSNButton');

    // Make the SSN fields editable
    ssnInput.readOnly = false;
    confirmSSNInput.readOnly = false;

    // Reset the fields
    resetSSNFields();

    // Hide the "Edit SSN" button
    editSSNButton.style.display = 'none';
}

// Add an event listener to the confirm SSN field
document.getElementById('confirmSocialSecurityNumber').addEventListener('input', function () {
    validateConfirmSSN();
});

// Call the function after the page loads
window.onload = function () {
    toggleSidebarVisibility();
};
    </script>

<script src="editnavigation.js"></script>
<script src="applying.js"></script>
    <script src="applicant.js"></script>
    <script src="notes.js"></script>

</body>
</html>