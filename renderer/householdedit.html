<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Client Household</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="householdedit.css">
    <link rel="stylesheet" href="notes.css">
    <script src="userInfo.js"></script>


    <style>

.hidden {
    visibility: hidden;
}
        /* Highlight effect */
        .highlight {
            background-color: #007bff; /* Blue background */
            color: white; /* White text */
            border-radius: 5px; /* Optional: Rounded corners */
            padding: 5px; /* Optional: Add some padding */
        }
        </style>
        <script>
            // Add event listeners to toggle "highlight" class on heatingCrisis options
            document.querySelectorAll('#heatingCrisis-yes, #heatingCrisis-no').forEach(option => {
                option.addEventListener('click', function () {
                    // Remove the "highlight" class from both options
                    document.querySelectorAll('#heatingCrisis-yes, #heatingCrisis-no').forEach(el => el.classList.remove('highlight'));
            
                    // Add the "highlight" class to the clicked option
                    this.classList.add('highlight');
                });
            });
            </script>
    <style>

.readonly {
        background-color: #f0f0f0; /* Light gray background */
        color: #6c757d; /* Slightly muted text color */
        cursor: not-allowed; /* Show "not allowed" cursor */
    }

details > summary {
    cursor: pointer; /* Change cursor to hand */
}

.button-container button {
    border: 1px solid #000000; /* Add a blue border */
    border-radius: 5px; /* Optional: Add rounded corners */
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; /* Smooth transition for hover effects */
}

.button-container button:hover {
    background-color: #0056b3; /* Darker blue background on hover */
    color: white; /* Ensure text is visible */
    border-color: #003f7f; /* Darker border color on hover */
}

.error {
    border: 2px solid red;
}

.household-member-info p {
    text-align: left; /* Ensure text is left-aligned */
    word-wrap: break-word; /* Allow long words to break and wrap */
    white-space: normal; /* Ensure normal wrapping behavior */
}
body {
    max-width: 1200px; /* Adjust the max-width as needed */
    margin: 0 auto;
    padding: 20px;
    margin-top: 60px; /* Adjust this value to match the height of the navigation container */

}
        
    </style>
    <style>
        .button-container {
                display: flex;
                gap: 10px; /* Adds spacing between buttons */
                flex-wrap: wrap; /* Ensures buttons wrap to the next line if needed */
            }
        
            .button-container button {
                flex: 1; /* Ensures buttons are evenly spaced */
                padding: 10px 15px;
            }

            /* Modal content styling */
.modal-content {
    background-color: #ffffff;
    border-radius: 10px;
    width: 100%;
    max-width: 500px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    position: relative;
    text-align: center;
}

.narrow-body {
        margin-left: 385px; /* Space for the left sidebar */
        margin-right: 10px; /* Optional: Space on the right */
        max-width: calc(100% - 395px); /* Ensure the body doesn't exceed the available space */
        margin: 0 auto; /* Center the content horizontally */
        margin-top: 60px; /* Adjust this value to match the height of the navigation container */
    }
        
            </style>
</head>
<body class="narrow-body hidden">

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
    await loadSavedData(); // Load and display saved data
    document.body.classList.remove('hidden'); // Show the body after processing
});
    </script>

    <h1>Household</h1>

    <style>
        #household-size {
            text-align: center; /* Center the text */
            text-align-last: center; /* Center the selected option in modern browsers */
        }
    </style>

<div class="left-sidebar-container" id="leftSidebarContainer" style="display: none;">
    <div id="snap-household-container" class="left-sidebar"></div>
    <div id="liheap-household-container" class="left-sidebar"></div>
    <div id="household-members-container" class="left-sidebar"></div>
</div>

<div id="notes-container">
    <textarea id="note-input" placeholder="Add Note..."></textarea>
    <button id="save-note">Save Note</button>
    <div id="notes-list">
        </div>
        </div>
    
    <div class="selection-box">
        <label for="household-size">How many people reside in the household?</label>
        <select id="household-size">
            <option value="" disabled selected>Select household size</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
            <option value="13">13</option>
            <option value="14">14</option>
            <option value="15">15</option>
        </select>
    </div>

    <div class="selection-box">
        <label id="disability-label">Is anyone in the household currently receiving disability benefits?</label>
        <div id="disability-yes" data-value="yes">Yes</div>
        <div id="disability-no" data-value="no">No</div>
    </div>
    
    <div class="selection-box">
        <label id="medicare-label">Is anyone in the household currently enrolled in Medicare (or will be within the next three months)?</label>
        <div id="medicare-yes" data-value="yes">Yes</div>
        <div id="medicare-no" data-value="no">No</div>
    </div>

    <div class="selection-box">
        <label id="medicaid-label">Is anyone in the household currently enrolled in Medicaid?</label>
        <div id="medicaid-yes" data-value="yes">Yes</div>
        <div id="medicaid-no" data-value="no">No</div>
    </div>

    <div class="selection-box">
        <label id="citizen-label">Is everyone in the household a U.S. citizen?</label>
        <div id="citizen-yes" data-value="yes">Yes</div>
        <div id="citizen-no" data-value="no">No</div>
    </div>

    <div class="selection-box">
        <label id="student-label">Is anyone in the household currently a student?</label>
        <div id="student-yes" data-value="yes">Yes</div>
        <div id="student-no" data-value="no">No</div>
    </div>

    <div class="selection-box">
        <label id="snap-label">Are you currently enrolled in SNAP?</label>
        <div id="snap-yes" data-value="yes">Yes</div>
        <div id="snap-no" data-value="no">No</div>
        <div id="snap-notinterested" data-value="notinterested">Not Interested</div>
    </div>

    <div class="selection-box">
        <label id="liheap-label">Has your household already received LIHEAP this season?</label>
        <div id="liheap-yes" data-value="yes">Yes</div>
        <div id="liheap-no" data-value="no">No</div>
        <div id="liheap-notinterested" data-value="notinterested">Not Interested</div>
    </div>

    <div class="selection-box" id="heatingCrisis-container" style="display: block;">
        <label id="heatingCrisis-label">Are you in danger of losing your heating in the next 15 days?</label>
        <div id="heatingCrisis-yes" data-value="yes">Yes</div>
        <div id="heatingCrisis-no" data-value="no">No</div>
    </div>

    <div class="selection-box" id="residenceStatusCurrent-container">
        <label id="residenceStatusCurrent-label">What is your current residence status?</label>
        <div id="residenceStatusCurrent-owned" data-value="owned">Own Home</div>
        <div id="residenceStatusCurrent-rented" data-value="rented">Renting with Formal Lease</div>
        <div id="residenceStatusCurrent-rentedowned" data-value="rentedowned">Own/Rent</div>
        <div id="residenceStatusCurrent-other" data-value="other">Other/No Formal Agreement</div>
    </div>

    <div class="selection-box">
        <label id="residenceStatus-label">What was your residence status during the previous year?</label>
        <div id="residenceStatus-owned" data-value="owned">Owned Home</div>
        <div id="residenceStatus-rented" data-value="rented">Rented with Formal Lease</div>
        <div id="residenceStatus-rentedowned" data-value="rentedowned">Owned/Rented</div>
        <div id="residenceStatus-other" data-value="other">Other/No Formal Agreement</div>
    </div>

    <div class="selection-box" id="subsidizedHousing-container" style="display: none;">
        <label id="subsidizedHousing-label">Does your household receive a housing subsidy, such as Section 8?</label>
        <div id="subsidizedHousing-yes" data-value="yes">Yes</div>
        <div id="subsidizedHousing-no" data-value="no">No</div>
    </div>
    
    <div class="selection-box" id="heatingCost-container" style="display: none;">
        <label id="heatingCost-label">Is the cost of your heating included in the cost of rent?</label>
        <div id="heatingCost-yes" data-value="yes">Yes</div>
        <div id="heatingCost-no" data-value="no">No</div>
    </div>

    <div class="button-container">
        <button id="add-household-member">Add Household Member</button>
        <button id="save-exit" onclick="redirectToHouseholdView()">Save and Release Profile</button>
        <button id="save-continue" onclick="goToRelationshipsEdit()">Save and Continue</button> <br>
    </div>

    <div id="householdMemberContainer" class="household-member-container"></div>

<!-- Add this to your HTML -->
<div id="loading-indicator" style="display: none;">Loading...</div>

<div id="householdMemberModal" class="modal">
    <div class="modal-content">
        <form id="householdMemberForm">

            <h2 id="modal-header">Add Household Member</h2>

            <input type="hidden" id="householdMemberId">
<!-- Prefix Dropdown -->
<label for="prefix">Prefix:</label>
<select id="prefix" name="prefix">
    <option value="" disabled selected>Select Prefix</option>
    <option value="">NONE</option>
    <option value="BR">BR</option>
    <option value="FTHR">FATHR</option>
    <option value="MTHR">MTHR</option>
    <option value="REB">REB</option>
    <option value="REV">REV</option>
    <option value="SR">SR</option>
</select><br><br>

<!-- First Name -->
<label for="firstName">First Name:</label>
<input type="text" id="firstName" name="firstName"><br><br>

<!-- Middle Initial -->
<label for="middleInitial">Middle Initial:</label>
<input type="text" id="middleInitial" name="middleInitial"><br><br>

<!-- Last Name -->
<label for="lastName">Last Name:</label>
<input type="text" id="lastName" name="lastName"><br><br>

<!-- Suffix Dropdown -->
<label for="suffix">Suffix:</label>
<select id="suffix" name="suffix">
    <option value="" disabled selected>Select Suffix</option>
    <option value="">NONE</option>
    <option value="JR">JR</option>
    <option value="SR">SR</option>
    <option value="I">I</option>
    <option value="II">II</option>
    <option value="III">III</option>
    <option value="IV">IV</option>
    <option value="V">V</option>
    <option value="VI">VI</option>
    <option value="VII">VII</option>
</select><br><br>
            <div class="selection-box">
                <label for="dob">Date of Birth:</label>
                <input type="date" id="dob" name="dob" class="selection-box-input"><br><br>
            </div>

            <script>
                // Initialize Flatpickr for the Start Date field
                flatpickr("#dob", {
                    dateFormat: "Y-m-d", // Format: 2026-01-01
                    altInput: true,      // Show a user-friendly date format
                    altFormat: "F j, Y", // Format: January 1, 2026
                });
            </script>

            <div class="selection-box">
                <label for="legalSex">Legal Sex:</label>
                <select id="legalSex" name="legalSex" class="selection-box-input">
                    <option value="" disabled selected>Select Legal Sex</option>
                    <option value="MALE">MALE</option>
                    <option value="FEMALE">FEMALE</option>
                    </select><br><br>
            </div>

            <div class="selection-box">
                <label for="maritalStatus">Current Marital Status:</label>
                <select id="maritalStatus" name="maritalStatus" class="selection-box-input">
                    <option value="" disabled selected>Select Marital Status</option>
                    <option value="Single">Single</option>
                    <option value="Married (Living Together)">Married (Living Together)</option>
                    <option value="Married (Living Separately)">Married (Living Separately)</option>
                    <option value="Divorced">Divorced</option>
                    <option value="Widowed">Widowed</option>
                </select><br><br>
            </div>
            <div class="selection-box">
                <label for="previousMaritalStatus">Previous Year Marital Status:</label>
                <select id="previousMaritalStatus" name="previousMaritalStatus" class="selection-box-input">
                    <option value="" disabled selected>Select Previous Year Marital Status</option>
                    <option value="Single">Single</option>
                    <option value="Married (Living Together)">Married (Living Together)</option>
                    <option value="Married (Living Separately)">Married (Living Separately)</option>
                    <option value="Divorced">Divorced</option>
                    <option value="Widowed">Widowed</option>
                </select><br><br>
            </div>
            <label for="socialSecurityNumber">Social Security Number:</label>
            <input type="text" 
                id="socialSecurityNumber" 
                name="socialSecurityNumber" 
                placeholder="xxx-xx-xxxx" 
                maxlength="11" 
                oninput="formatSSN(this)" 
                readonly
                class="readonly"
            >
            <button type="button" id="nextSSNButton" onclick="showConfirmSSN()" style="display: none;">Next</button><br><br>
            
            <div id="confirmSSNContainer" style="display: none;">
                <label for="confirmSocialSecurityNumber">Confirm Social Security Number:</label>
                <input 
                    type="text" 
                    id="confirmSocialSecurityNumber" 
                    name="confirmSocialSecurityNumber" 
                    placeholder="xxx-xx-xxxx" 
                    maxlength="11" 
                    oninput="formatSSN(this)" 
                    readonly
                    class="readonly"
                >
            </div>
            <div id="disabilityQuestion" class="selection-box">
                <label>Is this person receiving disability benefits?</label>
                <div id="modal-disability-yes" data-value="yes">Yes</div>
                <div id="modal-disability-no" data-value="no">No</div>
            </div>
            <div id="medicareQuestion" class="selection-box">
                <label>Is this person enrolled in Medicare (or will they be within the next three months)?</label>
                <div id="modal-medicare-yes" data-value="yes">Yes</div>
                <div id="modal-medicare-no" data-value="no">No</div>
            </div>
            <div id="medicaidQuestion" class="selection-box">
                <label>Is this person enrolled in Medicaid?</label>
                <div id="modal-medicaid-yes" data-value="yes">Yes</div>
                <div id="modal-medicaid-no" data-value="no">No</div>
            </div>
            <div id="citizenQuestion" class="selection-box">
                <label>Is this person a U.S. citizen?</label>
                <div id="modal-citizen-yes" data-value="yes">Yes</div>
                <div id="modal-citizen-no" data-value="no">No</div>
            </div>
            <div id="nonCitizenStatusContainer" style="display: none; margin-top: 10px;">
                <label for="nonCitizenStatus">Select Non-Citizenship Status:</label>
                <select id="nonCitizenStatus">
                    <option value="" disabled selected>Select status</option>
                    <option value="Lawful Permanent Resident (5+ Years)">Lawful Permanent Resident (5+ Years)</option>
                    <option value="Refugee">Refugee</option>
                    <option value="Asylee">Asylee</option>
                    <option value="Person Whose Deportation is Withheld">Person Whose Deportation is Withheld</option>
                    <option value="Conditional Entrant (5+ Years)">Conditional Entrant (5+ Years)</option>
                    <option value="Victim of Severe Trafficking">Victim of Severe Trafficking</option>
                    <option value="Cuban or Haitian Entrant">Cuban or Haitian Entrant</option>
                    <option value="Iraqi or Afghan Special Immigrant">Iraqi or Afghan Special Immigrant</option>
                    <option value="Child Under 18 in Qualified Non-Citizen Category">Child Under 18 in Qualified Non-Citizen Category</option>
                    <option value="Hmong or Highland Laotian Tribal Members">Hmong or Highland Laotian Tribal Members</option>
                    <option value="Citizen of Micronesia, Marshall Islands, or Palau">Citizen of Micronesia, Marshall Islands, or Palau</option>
                    <option value="Amerasian">Amerasian</option>
                    <option value="Person Paroled in the U.S. (1+ Years)">Person Paroled in the U.S. (1+ Years)</option>
                    <option value="Non-Citizen Who is Blind or Disabled and Receiving Disability Benefits">Non-Citizen Who is Blind or Disabled and Receiving Disability Benefits</option>
                    <option value="Non-Citizen Who Was 65+ and Lawfully Residing in the U.S. on August 22, 1996">Non-Citizen Who Was 65+ and Lawfully Residing in the U.S. on August 22, 1996</option>
                    <option value="Ineligible Non-Citizen">Ineligible Non-Citizen</option>
                </select>
            </div>
            <div id="studentQuestion" class="selection-box">
                <label>Is this person a student?</label>
                <div id="modal-student-yes" data-value="yes">Yes</div>
                <div id="modal-student-no" data-value="no">No</div>
            </div>
            <div id="studentStatusContainer" style="display: none; margin-top: 10px;">
                <label for="studentStatus">Select Student Status:</label>
                <select id="studentStatus">
                    <option value="" disabled selected>Select status</option>
                    <option value="Enrolled Less than Half-Time">Enrolled Less than Half-Time</option>
                    <option value="Under Age 18">Under Age 18</option>
                    <option value="High School Student">High School Student</option>
                    <option value="Age 50 or Older">Age 50 or Older</option>
                    <option value="Physically or Mentally Unfit for Employment">Physically or Mentally Unfit for Employment</option>
                    <option value="Employed at Least 20 Hours Per Week">Employed at Least 20 Hours Per Week</option>
                    <option value="Participating in a Work Study Program">Participating in a Work Study
                    <option value="Participating in a Job Training Program">Participating in a Job Training Program</option>
                    <option value="Assigned to or Placed in College through a SNAP Employment or Training Program">Assigned to or Placed in College through a SNAP Employment or Training Program</option>
                    <option value="Responsible for the Care of a Child Under 6">Responsible for the Care of a Child Under 6</option>
                    <option value="Responsible for the Care of a Child Aged 6-12 and No Adequate Child Care Available">Responsible for the Care of a Child Aged 6-12 and No Adequate Child Care Available</option>
                    <option value="Single Parent Enrolled Full-Time and Responsible for a Child Under 12">Single Parent Enrolled Full-Time and Responsible for a Child Under 12</option>
                    <option value="TANF Recipient">TANF Recipient</option>
                    <option value="Ineligible Student">Ineligible Student</option>
                </select>
            </div>
            <div id="mealsQuestion" class="selection-box">
                <label>Is this person included in the SNAP household?</label>
                <div id="modal-meals-yes" data-value="yes">Yes</div>
                <div id="modal-meals-no" data-value="no">No</div>
            </div>
            <button type="button" id="add-member" class="submit-button">Add Member</button>

        </form>

    <script>
// Utility function to get query parameters
function getQueryParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
}

function goToRelationshipsEdit() {
    const clientId = getQueryParam('id'); // Retrieve the client ID from the URL
    if (!clientId) {
        console.error('Client ID not found in query parameters.');
        return;
    }

    fetch(`/get-client/${clientId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Failed to fetch client data: ${response.statusText}`);
            }
            return response.json();
        })
        .then(clientData => {
            if (!clientData) {
                console.error('Client data not found.');
                return;
            }

            // Debugging: Log the data
            console.log('Client Data:', clientData);
            console.log('Household Members Length:', clientData.householdMembers.length);
            console.log('Household Size:', clientData.householdSize);

            // Ensure householdSize is a number
            if (clientData.householdMembers.length !== Number(clientData.householdSize)) {
                alert('The number of household members does not match the selected household size. Please review your entries before continuing.');
                return; // Prevent navigation
            }

            // If validation passes, navigate to the relationships edit page
            window.location.href = `relationshipsedit.html?id=${clientId}`;
        })
        .catch(error => {
            console.error('Error validating household data:', error);
        });
}

// Add event listeners to toggle "selected" class on div-based options
document.querySelectorAll('[id^="disability-"], [id^="medicare-"], [id^="medicaid-"], [id^="citizen-"], [id^="student-"], [id^="snap-"], [id^="liheap-"], [id^="residenceStatusCurrent-"], [id^="residenceStatus-"]').forEach(option => {
    option.addEventListener('click', function () {
        // Get the group prefix (e.g., "heatingCrisis")
        const group = this.id.split('-')[0];

        // Get all elements in the group
        const groupElements = document.querySelectorAll(`[id^="${group}-"]`);

        // Remove the "selected" class from all elements in the group
        groupElements.forEach(el => el.classList.remove('selected'));

        // Add the "selected" class to the clicked element
        this.classList.add('selected');
    });
});

async function redirectToHouseholdView() {
    const clientId = getQueryParameter('id'); // Reuse the getQueryParameter function
    if (!clientId) {
        console.error('Client ID not found in query parameters.');
        return;
    }

    const confirmAction = confirm("Are you sure you want to save and release this profile?");
    if (!confirmAction) {
        return;
    }

    const noteContent = "Profile released.";
    const timestamp = new Date().toLocaleString();
    const activeUser = sessionStorage.getItem('loggedInUser'); // Retrieve the active user

    if (!activeUser) {
        console.error("No active user found in sessionStorage.");
        return;
    }

    try {

        await setCheckedOutStatus(clientId, false);

        // Add a note about the action
        const note = {
            text: noteContent,
            timestamp: timestamp,
            username: activeUser
        };

        const noteResponse = await fetch(`/add-note-to-client`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ clientId, note }),
        });

        if (!noteResponse.ok) {
            throw new Error(`Failed to add note: ${noteResponse.statusText}`);
        }

        // Update screening status in the database
        const updateResponse = await fetch(`/update-client`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                clientId,
                clientData: { screeningInProgress: false },
            }),
        });

        if (!updateResponse.ok) {
            const error = await updateResponse.json();
            console.error('Error details:', error);

            // Check if the error message indicates no changes were made
            if (error.message === 'No changes were made to the client data.') {
                console.log('No changes were made, but proceeding with redirect.');
                // Redirect to the household view page
                window.location.href = `householdview.html?id=${clientId}`;
            } else {
                throw new Error(`Failed to update client: ${error.message}`);
            }
        } else {
            // Redirect to household view
            window.location.href = `householdview.html?id=${clientId}`;
        }
    } catch (error) {
        console.error("Error during redirectToHouseholdView:", error);
    }
}

async function toggleSidebarVisibility() {
    const clientId = getQueryParam('id');
    try {
        // Fetch client data via REST API
        const response = await fetch(`/get-client/${clientId}`);
        if (!response.ok) {
            throw new Error(`Failed to fetch client data: ${response.statusText}`);
        }
        const client = await response.json();
        console.log('Client data:', client); // Debugging
        console.log('screeningInProgress:', client?.screeningInProgress); // Debugging

        if (client && client.screeningInProgress) {
            document.getElementById('leftSidebarContainer').style.display = 'block';
            console.log('Sidebar is now visible'); // Debugging
        } else {
            document.getElementById('leftSidebarContainer').style.display = 'none';
            console.log('Sidebar is now hidden'); // Debugging
        }
    } catch (error) {
        console.error('Error toggling sidebar visibility:', error);
    }
}

function showConfirmSSN() {
    const ssnLabel = document.querySelector('label[for="socialSecurityNumber"]');
    const ssnInput = document.getElementById('socialSecurityNumber');
    const nextButton = document.getElementById('nextSSNButton');
    const confirmSSNContainer = document.getElementById('confirmSSNContainer');

    // Check if the SSN field is filled
    if (ssnInput.value.length === 11) {
        // Hide the SSN label, input, and button
        ssnLabel.style.display = 'none';
        ssnInput.style.display = 'none';
        nextButton.style.display = 'none';

        // Show the Confirm SSN input
        confirmSSNContainer.style.display = 'block';
    } else {
        alert('Please enter a valid Social Security Number before proceeding.');
    }
}

function resetSSNFields() {
    const ssnLabel = document.querySelector('label[for="socialSecurityNumber"]');
    const ssnInput = document.getElementById('socialSecurityNumber');
    const nextButton = document.getElementById('nextSSNButton');
    const confirmSSNContainer = document.getElementById('confirmSSNContainer');
    const confirmSSNInput = document.getElementById('confirmSocialSecurityNumber');

    // Reset visibility
    ssnLabel.style.display = 'block';
    ssnInput.style.display = 'block';
    nextButton.style.display = 'inline-block';
    confirmSSNContainer.style.display = 'none';

    // Clear input values
    ssnInput.value = '';
    confirmSSNInput.value = '';
}

function formatSSN(input) {
    const nextButton = document.getElementById('nextSSNButton');

    // Remove all non-digit characters
    let value = input.value.replace(/\D/g, '');

    // Format the value as ###-##-####
    if (value.length > 3 && value.length <= 5) {
        value = `${value.slice(0, 3)}-${value.slice(3)}`;
    } else if (value.length > 5) {
        value = `${value.slice(0, 3)}-${value.slice(3, 5)}-${value.slice(5, 9)}`;
    }

    // Set the formatted value back to the input
    input.value = value;

    // Only show the "Next" button for the initial SSN field
    if (input.id === 'socialSecurityNumber') {
        if (value.length === 11) {
            nextButton.style.display = 'inline-block';
        } else {
            nextButton.style.display = 'none';
        }
    }
}

function validateConfirmSSN() {
    const ssnInput = document.getElementById('socialSecurityNumber');
    const confirmSSNInput = document.getElementById('confirmSocialSecurityNumber');

    // Check if the confirm SSN field has 11 characters
    if (confirmSSNInput.value.length === 11) {
        if (confirmSSNInput.value !== ssnInput.value) {
            alert('The Social Security Numbers entered do not match. Please try again.');
            resetSSNFields(); // Reset both fields
        }
    }
}

// Add an event listener to the confirm SSN field
document.getElementById('confirmSocialSecurityNumber').addEventListener('input', function () {
    validateConfirmSSN();
});

async function setCheckedOutStatus(clientId, status) {
    try {
        const response = await fetch('/update-client', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ 
                clientId, 
                clientData: { 
                    checkedOut: [
                        {
                            status: status, // Set status to false
                            timestamp: status ? new Date().toISOString() : null, // Clear timestamp if status is false
                            user: status ? sessionStorage.getItem('loggedInUser')?.trim() || 'Unknown User' : null // Clear user if status is false
                        }
                    ] 
                } 
            }),
        });

        const result = await response.json();
        if (!response.ok || !result.success) {
            console.error(`Failed to update checkedOut status to ${status}:`, result.message);
        } else {
            console.log(`Successfully updated checkedOut status to ${status}.`);
        }
    } catch (error) {
        console.error(`Error updating checkedOut status to ${status}:`, error);
    }
}

// Call the function after the page loads
window.onload = function () {
    toggleSidebarVisibility();
};
    </script>

<script src="estimations.js"></script>
    <script src="householdedit.js"></script>
    <script src="editnavigation.js"></script>
    <script src="notes.js"></script>

</body>
</html>